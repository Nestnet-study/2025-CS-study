
> [!NOTE] OAuth는 인가만, OIDC는 인증+인가, 소셜로그인은 OIDC프로토콜로 구현된 서비스


## 1. OAuth
---

### OAuth의 정의
---

**OAuth(Open Authorization)**는 **제3자 애플리케이션이 사용자의 계정 정보에 안전하게 접근할 수 있도록 하는 개방형 표준 프로토콜**입니다. 사용자가 비밀번호를 직접 제공하지 않고도 다른 서비스의 기능을 사용할 수 있게 해주는 **인증 및 인가 프레임워크**입니다.



### OAuth의 핵심 개념
---

#### OAuth의 목적

- **비밀번호 공유 없이** 제3자 애플리케이션에 권한 부여
- **사용자의 개인정보 보호**
- **제한된 권한**만 부여 (필요한 정보에만 접근)
- **언제든지 권한 철회** 가능

#### OAuth 2.0의 주요 구성 요소

**1. Resource Owner (자원 소유자)**

- **사용자 본인**
- 보호된 자원에 대한 접근 권한을 부여할 수 있는 개체

**2. Client (클라이언트)**

- **제3자 애플리케이션**
- 사용자의 자원에 접근하고자 하는 애플리케이션
- 예: 쇼핑몰 웹사이트, 모바일 앱

**3. Resource Server (자원 서버)**

- **사용자의 정보를 가지고 있는 서버**
- 예: Google의 사용자 정보, Facebook의 프로필 정보

**4. Authorization Server (인증 서버)**

- **권한을 부여하는 서버**
- 사용자 인증 후 클라이언트에게 액세스 토큰 발급
- 예: Google OAuth 서버, Facebook Login 서버






### OAuth 2.0 동작 흐름
---

#### Authorization Code Grant 방식 (가장 일반적)

```
1단계: 사용자가 클라이언트에서 소셜 로그인 버튼 클릭

2단계: 클라이언트 → 인증 서버
   - 인증 서버로 리다이렉트
   - URL에 client_id, scope, redirect_uri 등 포함

3단계: 사용자 ← 인증 서버
   - 사용자에게 로그인 페이지 제공
   - 권한 동의 화면 표시

4단계: 사용자 → 인증 서버
   - 로그인 및 권한 동의

5단계: 인증 서버 → 클라이언트
   - Authorization Code와 함께 redirect_uri로 리다이렉트

6단계: 클라이언트 → 인증 서버
   - Authorization Code로 Access Token 요청

7단계: 인증 서버 → 클라이언트
   - Access Token 발급

8단계: 클라이언트 → 자원 서버
   - Access Token으로 사용자 정보 요청

9단계: 자원 서버 → 클라이언트
   - 사용자 정보 응답
```








### OAuth Token 종류
---

#### 1. Access Token

- **목적**: 자원 서버에 접근하기 위한 토큰
- **특징**: 짧은 수명 (보통 1-2시간)
- **용도**: API 호출 시 사용

#### 2. Refresh Token

- **목적**: Access Token 갱신을 위한 토큰
- **특징**: 긴 수명 (몇 주~몇 달)
- **용도**: Access Token 만료 시 새로운 토큰 발급




### OAuth의 한계
---

많은 사람들이 `OAuth == 소셜 로그인`이라고 알고 있습니다. 반은 맞고 반은 틀린 것인데, **OAuth**는 **인가를 위한 프로토콜**인데 로그인과 같은 **인증은 하지 못합니다**.

OAuth는 **권한 부여(인가)**를 위한 프로토콜입니다. 하지만 실제 서비스에서는 **권한을 가진 것이 아닌** 실제로 사용자가 **내 서비스의 회원인지 확인하는 인증 기능**도 필요했습니다.









## 2. 소셜 로그인과 OpenID Connect (OIDC)
---

### 소셜 로그인이란?
---

**소셜 로그인(Social Login)**은 **기존의 소셜 미디어 계정(Google, Facebook, 네이버, 카카오 등)을 이용하여 다른 웹사이트나 애플리케이션에 로그인하는 방식**입니다.

### 소셜 로그인의 장점
---
#### 사용자 관점

- **회원가입 과정 생략** (간편 가입)
- **비밀번호 기억할 필요 없음**
- **빠른 로그인 경험**
- **신뢰할 수 있는 서비스** 이용

#### 서비스 제공자 관점

- **사용자 획득 비용 감소**
- **회원가입 전환율 향상**
- **사용자 인증 부담 감소**
- **기본 사용자 정보 확보**




### OpenID Connect (OIDC)의 등장
---

이를 위해 인증 방식이 추가되었는데 이것이 바로 **OpenID Connect (OIDC)**입니다!

**OIDC는 OAuth 2.0 위에 인증을 하기 위한 프로토콜**로, 누가 로그인했는지를 검증하고 추가 리소스를 제공합니다.

- **OAuth 2.0**: 리소스에 대한 **접근 권한 여부**만 다룸
- **OIDC**: **누가 로그인했는지** 검증하는 기능 추가



### OIDC의 핵심: ID Token
---

#### ID Token (OpenID Connect)

- **목적**: 사용자 인증 정보를 담은 JWT 토큰
- **특징**: 사용자 정보가 토큰에 포함됨
- **용도**: 사용자 신원 확인

**ID Token은 JWT 형태로, 사용자의 신원 정보가 직접 포함**:

javascript

```javascript
{
  "sub": "1234567890",           // 사용자 고유 ID
  "name": "John Doe",            // 사용자 이름  
  "email": "john@example.com",   // 이메일
  "iat": 1516239022,            // 발급 시간
  "exp": 1516242622             // 만료 시간
}
```






## 3. OAuth, OIDC, 소셜 로그인 비교
---

| 구분          | OAuth 2.0      | OpenID Connect (OIDC)   | 소셜 로그인                  |
| ----------- | -------------- | ----------------------- | ----------------------- |
| **목적**      | 권한 부여 (인가)     | 인증 + 권한 부여              | 간편 로그인 서비스              |
| **프로토콜**    | OAuth 2.0 프로토콜 | OAuth 2.0 + 인증 확장       | OIDC 프로토콜 사용            |
| **받는 토큰**   | Access Token   | Access Token + ID Token | Access Token + ID Token |
| **사용자 확인**  | API 호출 필요      | ID Token으로 즉시 확인        | ID Token으로 즉시 확인        |
| **실제 사용 예** | API 권한 위임      | 로그인 + API 사용            | Google/카카오 로그인          |
|             |                |                         |                         |

### 실제 차이점 예시
---

#### OAuth 2.0만 사용할 때


```javascript
// 받는 것
{
  "access_token": "ya29.a0ARrdaM9...",      // 권한 정보만
}

// 문제점: 이 토큰이 누구 것인지 모름!
// 매번 API를 호출해서 확인해야 함
const userInfo = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
  headers: { 'Authorization': `Bearer ${accessToken}` }
});
```

#### OIDC 사용할 때 (실제 소셜 로그인)


```javascript
// 받는 것
{
  "access_token": "ya29.a0ARrdaM9...",      // 권한 정보 (인가)
  "id_token": "eyJhbGciOiJSUzI1NiIs...",    // 신원 정보 (인증) ⭐
  "scope": "openid email profile"           // openid 포함
}

// 장점: ID Token만 보면 즉시 누구인지 알 수 있음!
const idToken = jwt.decode(response.id_token);
console.log(`로그인한 사용자: ${idToken.name}`); // API 호출 없이 즉시 확인
```


### 정리

- ==**OAuth 2.0**: "권한만" 다루는 프로토콜==
- ==**OIDC**: OAuth + "누가 로그인했는지" 확인하는 인증 기능==
- ==**소셜 로그인**: OIDC를 활용하여 구현하는 실제 서비스==

**따라서 우리가 "소셜 로그인"이라고 부르는 것들은 사실 OAuth가 아니라 OIDC를 사용하는 것이 더 정확합니다!**

---
## 보안 고려사항

#### 1. HTTPS 필수
- 모든 OAuth 통신은 **HTTPS**로만 진행
- 토큰 탈취 방지

#### 2. State 매개변수
- **CSRF 공격 방지**를 위한 랜덤 값
- 요청과 응답의 일치성 확인

#### 3. Scope 제한
- **최소 권한 원칙** 적용
- 필요한 정보에만 접근 권한 요청

#### 4. Token 저장 보안
- **localStorage보다는 httpOnly 쿠키** 사용 권장
- XSS 공격으로부터 토큰 보호