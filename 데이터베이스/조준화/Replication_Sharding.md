# 복제와 샤딩

## 1. RDBMS의 수평적 확장이 근본적으로 어려운 이유

### 데이터의 관계(Relation)와 정합성 유지 문제

- **JOIN 연산의 복잡성**: JOIN이 필요한 두 테이블이 다른 노드에 분산되어 있는 경우 네트워크 통신이 일어나면서 큰 오버헤드가 발생한다.
- **외래 키(Foreign Key) 제약 조건**

### 트랜잭션의 ACID 원칙 유지의 어려움

- **분산 트랜잭션(Distributed Transaction)**: 하나의 트랜잭션이 여러 노드의 데이터를 변경해야 할 경우 모든 서버에서 작업이 성공하거나 모두 실패해야 한다. 이를 보장하기위해 Two-phase Commit 과 같은 기술을 사용할 수 있지만 매우 복잡하고 성능 저하를 유발한다.
- **일관성 유지**: 모든 서버의 데이터가 항상 동일한 상태를 유지하도록 동기화하는 것은 매우 어려운 문제이다.

---

## 2. 그럼에도 수평적 확장은 가능하다.

### 복제 (Replication)

- 원본 데이터베이스(Master)를 복제한 여러 개의 사본 데이터베이스(Slave/Replica)를 만드는 방식이다.
  - 쓰기는 Master 에서만 수행되며 Read는 여러 Slave로 분산하여 처리한다.
- 장점 : 대부분의 웹 서비스가 읽기 작업이 훨씬 많기에 효과적으로 작업을 분산할 수 있다.
- 단점 : 쓰기 작업은 전혀 분산되지 않고, Master와 Slave 간의 동기화 지연이 발생할 수 있다.

### 샤딩 (Sharding)

- 거대한 테이블을 Sharding Key에 따라 논리적인 여러 테이블, 샤드로 쪼개어 서로 다른 서버에 저장하는 방식이다.
  - 예를 들어 사용자 ID의 끝자리를 기준으로 짝수는 A 서버에, 홀수는 B 서버에 저장하는 방식이다.
- 장점 : 데이터 자체를 분산하여 저장하므로 쓰기, 읽기 부하를 모두 분산할 수 있다.
- **단점**
  - Sharding Key의 선정이 어렵다. 잘못 선정하면 특정 서버에만 데이터가 몰릴 수 있다.
  - 서로 다른 샤드에 있는 데이터를 JOIN 하는 것은 매우 어렵다. 따라서 비정규화를 감수하는 경우가 많다.
